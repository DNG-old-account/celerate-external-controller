<template name="customer_dashboard">
<body>
{{> header}}
<div class="page-wrap">  
  <div class="container customer-dashboard-container">
    <div class="row">
      <div class="col-xs-12">
        <div class="page-header">
          <h1>Further Reach Customer Dashboard</h1>
        </div>
      </div>
    </div>
    {{#if loading}}
    <div class="throbber-container">
      <div id="floatingCirclesG">
        <div class="f_circleG" id="frotateG_01">
        </div>
        <div class="f_circleG" id="frotateG_02">
        </div>
        <div class="f_circleG" id="frotateG_03">
        </div>
        <div class="f_circleG" id="frotateG_04">
        </div>
        <div class="f_circleG" id="frotateG_05">
        </div>
        <div class="f_circleG" id="frotateG_06">
        </div>
        <div class="f_circleG" id="frotateG_07">
        </div>
        <div class="f_circleG" id="frotateG_08">
        </div>
      </div> 
    </div>
    {{else}}
    {{#if connected}}
    {{else}}
    <div class="row">
      <div class="col-xs-12">
        <div class="not-connected-warning-container">
          {{> not_connected_warning }}
        </div>
      </div>
    </div>
    {{/if}}
    {{#if subscriberInfo.plan}}
    {{else}}
    <div class="row">
      <div class="col-xs-12">
        <div class="no-plan-warning-container">
          {{> plan_warning }}
        </div>
      </div>
    </div>
    {{/if}}
    <div class="row">
      <div class="col-xs-12">
        {{#if subscriberInfo.agreedToTerms}}
        {{else}}
        <div class="agreement-info-container">
          {{> agreement_info }}
        </div>
        {{/if}}
      </div>
    </div>
    {{#if subscriberInfo.plan}}
    {{#if subscriberInfo.activation_date}}
    <div class="row">
      <div class="col-xs-6">
        <div class="plan-info-container">
          {{> plan_info }}
        </div>
      </div>
      <div class="col-xs-6">
        <div class="subscriber-info-container">
          {{> subscriber_info }}
        </div>
      </div>
    </div>
    
    <div class="row">
      <div class="col-xs-12">
        <div class="payments-info-container">
          {{> required_payments }}
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <div class="payments-info-container">
          {{> payment_history }}
        </div>
      </div>
    </div>
    {{/if}}
    {{/if}}
    {{/if}}
  </div>
  <!-- <div class="json-dump"> -->
  <!--   <pre> -->
  <!--     {{{ json subscriberInfo }}} -->
  <!--   </pre> -->
  <!-- </div> -->
</div>
{{> footer}}
</body>
</template>

<template name="subscriber_info">
<div class="panel panel-primary contact-info-panel">
  <div class="panel-heading">
    <h2>Contact Information</h2>
  </div>
  <div class="panel-body">
    <div class="col-xs-12">
      <div class="row">
        <div class="col-xs-12">
          <h3 class="sub-header">{{ subscriberInfo.first_name }} {{ subscriberInfo.last_name }}</h3>
        </div>
      </div>
      {{> contact_snippet subscriberInfo }}
      {{#if subscriberInfo.contactInfo}}
        {{#each subscriberInfo.contactInfo}}
        <h4>{{ capitalize this.type }}</h4>
        {{> contact_snippet this }}
      {{/each}}
      {{/if}}
    </div>
  </div>
</div>
</template>

<template name="contact_snippet">
<div class="row">
  <div class="col-xs-2">
    <label>Name:</label>
  </div>
  <div class="col-xs-10">
    <div>
      {{ this.first_name }} {{ this.last_name }}
    </div>
  </div>
</div>
<div class="row">
  <div class="col-xs-2">
    <label>Email:</label>
  </div>
  <div class="col-xs-10">
    <div>
      {{#if this.prior_email}}
      {{ this.prior_email }}
      {{else}}
      {{#if this.email}}
        {{ this.email }}
      {{/if}}
      {{/if}}
    </div>
  </div>
</div>
<div class="row">
  <div class="col-xs-2">
    <label>Address:</label>
  </div>
  <div class="col-xs-10">
    <div>
      {{ this.street_address }}
    </div>
    <div>
      {{ this.city }}, {{ this.state }} {{ this.zip_code }}
    </div>
  </div>
</div>
{{#if this.landline}}
<div class="row">
  <div class="col-xs-2">
    <label>Landline:</label>
  </div>
  <div class="col-xs-10">
    <div>
      {{ this.landline }}
    </div>
  </div>
</div>
{{/if}}
{{#if this.mobile}}
<div class="row">
  <div class="col-xs-2">
    <label>Mobile:</label>
  </div>
  <div class="col-xs-10">
    <div>
      {{ this.mobile }}
    </div>
  </div>
</div>
{{/if}}
</template>

<template name="not_connected_warning">
<div class="panel panel-danger">
  <div class="panel-heading">
    <h2>Not Connected</h2>
  </div>
  <div class="panel-body">
    <div class="col-xs-12">
      <div class="row">
        <div class="col-xs-12">
          According to our systems, you haven't been connected yet! 
          Please contact <a href="mailto:support@furtherreach.net">support@furtherreach.net</a>
        </div>
      </div>
    </div>
  </div>
</div>
</template>

<template name="plan_warning">
<div class="panel panel-danger">
  <div class="panel-heading">
    <h2>No Plan Selected</h2>
  </div>
  <div class="panel-body">
    <div class="col-xs-12">
      <div class="row">
        <div class="col-xs-12">
          You haven't chosen a plan! Please contact support@furtherreach.net and inform them of your choice. To see a 
          list of plans, you can visit <a href="http://furtherreach.net/#plans">FurtherReach.net</a>
        </div>
      </div>
    </div>
  </div>
</div>
</template>

<template name="agreement_info">
<div class="panel panel-danger">
  <div class="panel-heading">
    <h2>Customer Agreement</h2>
  </div>
  <div class="panel-body">
    <div class="col-xs-12">
      <div class="row">
        <div class="col-xs-12">
          You haven't agreed to the terms and conditions yet! Click below to view and accept them.
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <button class="btn btn-success terms-conditions">Terms and Conditions</button>
        </div>
      </div>
    </div>
  </div>
</div>
</template>

<template name="payment_history">
{{#if paymentInfo}}
{{#if showCharges }}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h2>Payment History</h2>
  </div>

  <div class="panel-body">
    <div class="col-xs-12">
      <h3 class="sub-header">Charges</h3>
      {{#each paymentInfo.charges}}
      <div class="row charge-row">
        <div class="col-xs-2 charge-date">
          {{ this.dateCreatedString }} 
        </div>
        <div class="col-xs-2">
          {{#if paymentInfo.metadata.receipt_number}}
          <span class="bolded-label">{{paymentInfo.metadata.receipt_number}}</span>
          {{/if}} 
        </div>
        <div class="col-xs-2">
          <span class="bolded-label">Amount:</span> ${{ this.dollarAmount }}
        </div>
        <div class="col-xs-4">
          <span class="bolded-label">Description:</span> {{ this.description }}
        </div>
        <div class="col-xs-2">
          <span class="bolded-label">Card:</span> {{ this.card.brand}} ending in {{ this.card.last4 }}
        </div>
      </div>
      {{/each}}
    </div>
  </div>
</div>
{{/if}}
{{/if}}
</template>


<template name="required_payments">
{{#if requiredPayments.required }}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h2>Bill</h2>
  </div>

  <div class="panel-body">
    <div class="col-xs-12">
      {{#if requiredPayments.dueToDate.required }}
      <div class="row payment-row">
        <div class="col-xs-5 payment-start-date">
          {{#each requiredPayments.dueToDate.payments}}
          <div class="row detail-row monthly-period-dates">
            <div class="col-xs-12">
              <span class="bolded-label">Period:</span> {{ formatDate this.startDate "MM/DD/YYYY" }} - {{ formatDate this.endDate "MM/DD/YYYY"}}
            </div>
          </div>
          <div class="row detail-row monthly-period-plan">
            <div class="col-xs-12">
              <span class="bolded-label">Plan:</span> {{ this.plan.label }}
            </div>
          </div>
          {{/each}}
        </div>
        <div class="col-xs-7">
          <div class="row">
            <div class="col-xs-12">
              ${{ requiredPayments.dueToDate.amount }}
            </div>
          </div>
        </div>
      </div>
      {{/if}}
      {{#if requiredPayments.installation.paid}}
      {{else}}
      <div class="row payment-row">
        <div class="col-xs-5 payment-start-date">
          <div class="row">
            <div class="col-xs-12">
              Standard Installation
            </div>
          </div>
        </div>
        <div class="col-xs-7">
          <div class="row">
            <div class="col-xs-12">
              {{#if requiredPayments.installation.installments}}
              Remaining installation amount: ${{requiredPayments.installation.remaining_amount}}
              {{else}}
              ${{ requiredPayments.installation.standard_installation }}
              {{/if}}
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12">
              <select id="installment-choices" class="form-control">
                <option value="full">
                  Pay full installation 
                  {{#if requiredPayments.installation.remaining_amount}} 
                  - ${{requiredPayments.installation.remaining_amount}} 
                  {{/if}}
                </option>
                <option value="installment">
                  {{#if requiredPayments.installments}}
                  Pay installment - ${{installmentAmount}}
                  {{else}}
                  Pay installment - (6 payments of ${{installmentAmount}} each)
                  {{/if}}
                </option>
              </select>
            </div>
          </div>
        </div>
      </div>
     {{/if}}
      <div class="row">
        <div class="col-xs-offset-6 col-xs-6 total-payment">
          <span class="bolded-label">Total:</span> ${{totalPayment}}
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <button id="make-payment" class="btn btn-success make-payment">Make a Payment</button>
        </div>
      </div>
    </div>
  </div>
</div>
{{/if}}
</template>

<template name="plan_info">
<div class="panel panel-primary">
  <div class="panel-heading">
    <h2>Your Plan</h2>
  </div>
  <div class="panel-body">
    <div class="col-xs-12">
      <h3 class="sub-header">{{ planInfo.label }}</h3>
      <div class="row">
        <div class="col-xs-12">
          <label>Monthly Price:</label> ${{planInfo.monthly}}
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12">
          <label>Details:</label>
          {{ planInfo.details }}
        </div>
      </div>
    </div>
  </div>
</div>
</template>
