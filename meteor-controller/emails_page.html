<template name="emailsPage">
<body>
  {{> celerateNavbar}}
  <div class="container-fluid">
    <div class="row">
      <div class="main">
        {{> subscribersEmailsList}}
      </div>
    </div>
  </div>
</body>
</template>

<template name="subscribersEmailsList">
  <div class="subscriber-table-header">
    <div class="row">
      {{#each key_value current_search_fields}}
      <div class="col-md-2">
        <h4><span class="delete_search_field label label-default">{{key}}: {{value}}</span></h4>
      </div>
      {{/each}}
    </div>

    <div class="row">
      <div class="col-sm-12">
        <label for="see-needs-payment">See who needs payment</label>
        <input id="see-needs-payment" {{seeNeedsPaymentChecked}} type="checkbox"/>
      </div>
    </div>

    <div class="row">
      <div class="col-md-3">
        <select class="form-control" id="search_tag">
          {{#each searchable_fields}}
          <option value="{{this}}">{{this}}</option>
          {{/each}}
        </select>
      </div>
      <div class="col-md-3">
        <button type="button" class="btn btn-success" id="add_search_field">Add Search Field</button>
      </div>
    </div>
    <div class="row">
      <div class="col-md-8">
        <span class="glyphicon glyphicon-search"></span>
        <span class="badge">{{subscriber_count}}</span>
        <input class="subscriber_search_input" id="subscriber_search_input" type="search" placeholder="Search subscribers" value="">
      </div>
    </div>
    <div class="row">
      <div class="col-md-2">
        <button type="button" class="btn btn-warning" id="open_send_email">Send Email</button>
      </div>
    </div>
  </div>
  <div class="table_responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th class="name_header" style="cursor:pointer;">Full Name</th>
          <th class="status_header" style="cursor:pointer;">Status</th>
          <th class="address_header">Street Address</th>
          <th class="city_header" style="cursor:pointer;">City</th>
          <th>Plan</th>
          <th>Email</th>
          <th>Install Paid</th>
          <th>Needs Payment</th>
          <th id="select-all-emails">Send Email?</th>
        </tr>
      </thead>
      <tbody>
        {{#each subscribers}}
        {{> subscriber_email_row }}
        {{/each}}
      </tbody>
    </table>
  </div>
  <div id="subscriber_email" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">Ã—</button>
          <h3>Send an Email</h3>
        </div>
        <div class="modal-body">
          <select id="email-choice">
            {{#each key_value emailChoices}}
            <option value="{{key}}">{{value.label}}</option>
            {{/each}}
          </select>
          <h3>Subject: {{emailContents.subject}}</h3>
          <textarea disabled class="email-contents">{{emailContents.body}}</textarea>
        </div>
        <div class="modal-footer">
          <button class="btn" data-dismiss="modal" id='send_emails'>OK</button>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="subscriberEmailRow">
<tr class="subscriber {{selected}}">
  <td>{{first_name}} {{last_name}}</td>
  <td>{{status}}</td>
  <td>{{street_address}}</td>
  <td>{{city}}</td>
  <td>{{plan}}</td>
  <td>{{prior_email}}</td>
  <td>{{#if billing_info.installation.paid}}Yes{{else}}No{{/if}}</td>
  <td>{{#if billing_info.needsPayment}}Yes{{else}}No{{/if}}</td>
  <td>
    <input data-subscriber="{{_id._str}}" class="form-control email-sub" type="checkbox"/>
  </td>
</tr>
</template>
